<!DOCTYPE html>
<html lang = "en">
  <head>
    <meta charset = "utf-8">
    <meta name = "viewport" content = "width=device-width, initial-scale = 1.0">
    <title> thecycle</title>
    <link rel = "stylesheet" href = "https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel = "stylesheet" href = "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js">
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,900|Source+Sans+Pro:300,900&display=swap" rel="stylesheet">
    <link rel = "stylesheet" href = "..\..\css\coding\nba_spread.css">
    <script src="https://kit.fontawesome.com/7acb9305dd.js" crossorigin="anonymous"></script>
  </head>
  <body>
    <header>
      <div class = "logo">
        <img src = "..\..\images\logo\cycle_logo_crop1.jpg" alt = "" class = "logo__img">
      </div>
      <button class = "nav-toggle" aria-label="toggle navigation">
        <span class = "hamburger"></span>
      </button>
      <nav class = "nav">
        <ul class = "nav__list">
          <li class = "nav__item"><a href = "..\..\index.html"
            class = "nav__link" style = "font-size: 4.0rem;">Home</a></li>
          <li class = "nav__item"><a href = "..\categories\coding.html" class = "nav__link" style = "font-size: 4.0rem;">Chris Codes</a></li>
          <li class = "nav__item"><a href = "..\categories\commentating.html" class = "nav__link" style = "font-size: 4.0rem;">Chris Commentates</a></li>
          <li class = "nav__item"><a href = "..\categories\cooking.html" class = "nav__link" style = "font-size: 4.0rem;">Chris Cooks</a></li>
        </ul>
      </nav>
    </header>

  <!-- Introduction -->
    <section class = "intro">
      <h1 class = "section__title section__title--intro">
        Defying the Odds: Predicting NBA Spread</h1>
      <p class = "section__subtitle section__subtitle--intro">March 6th, 2020</p>
    </section>

    <img src = "..\..\images\coding\nba_spread\lebron.png" alt="" class = "intro__img">

    <div class = "portfolio-item-individual">
      <p>After having spent a large chunk of time learning the basics of various Python data and data science libraries
        (pandas, scikit-learn, matplotlib, beautiful soup, and others), I wanted to embark on an independent project that
        would allow me to refine my abilities…..which is a <b>TOTALLY</b> valid excuse to get a fix for my NBA cravings. </p>
      <p>As a <b>basketball</b> and <b>data science</b> fanatic, I love the idea of basing in game coaching decisions on numbers,
        mainly because I can't base in game decisions off my own skill since I’m not coordinated enough to excel at
          most sports but that is besides the point. For example, being able to statistically say that
          <i>Player A</i> should be at <i>Position
          B</i> of the basketball court at <i>Time C</i>, given the <i> Matchup D</i>,
          because these are the mathematical conditions that
          optimize the player’s and team’s percentage chance of scoring at that moment.</p>

        <p>  I am always intrigued to think and hear about the intersection
            of these two worlds. Talk of this intersection has been on the rise
            since the opportunities to capture and utilize the data of athletes are becoming more frequent,
            so it seems that these two regions are converging into an
            <a href ="https://hub.packtpub.com/sports-analytics-empowering-better-decision-making/" class = "inline-link" target = "_blank">
          integrated discipline</a>.</p>

        <p> One specific type of data analysis within the sports world is <b>predicting</b>. Predicting who is going to win. Predicting
            which player is going to have a standout performance. Predicting the victor of a series of games in the playoffs. And finally,
            a popular forecast in the betting world, predicting the <b>spread</b> of a sports game. </p>

            <p>For those who don't know, the spread of a sports game is by how much a team wins or loses a game.
            For example, if Team A scored 100 points and Team B scores 92 points, then this game is
            considered to have a spread of 8 in favor of Team A.
            Had Team A scored 92 points and Team B scores 100 points, then the game would have resulted
            in a spread of -8. </p>
      <p>With a desire to test out my newfound knowledge, an area of interest to pursue, and a sudden urge to wager some cash,
        I had my test question in mind:</p>
      <p class = "emph_line">Could I reasonably predict the
        spread of an NBA basketball game (and not go broke)?</p>
      <p> After having formalized the topic of my project, I did some thinking. How does one go about predicting an outcome?
          What stats are relevant? What stats are not relevant? How should different pieces of data be weighted differently?
          What kind of model would best represent this experiment?
          To what extent can an NBA game even be predicted, or just chalked up to random noise?</p>
      <p>Disregarding this aggressively inquisitive stream of thought and instead performing some background research
          pointed me in the direction that this has been a well
          <a href = "https://www.stat.berkeley.edu/~aldous/Research/Ugrad/Stanley_Yang%20_Thesis.pdf" class = "inline-link" target = "_blank">
            attempted question to answer </a>.
          Although mixed results have been observed, perhaps I could come up with a way to more
          accurately model this situation.</p>
      <p>Initially, I figured I should approach this experiment by determining what are the <b>most relevant
        predictors</b> of the outcome of an NBA game.
        There are an immense amount of methods. Perhaps I give more weight to the home team.
        Maybe I listen to expert analysis on the subject.
        Potentially I should learn more about the advanced basketball statistics,
        such as <a href = "https://aloneinthegreenroom.wordpress.com/statsketball/glossary-of-basketball-stats/#unique-identifier7" class = "inline-link" target = "_blank"> VORP and WARP</a>.
        You name it, an analyst has probably considred it.</p>
      <p>I have a tendency to undergo choice paralysis, especially when it comes to big projects,
        but choosing how to approach this issue was not an issue at all. I figured I would gather
        whatever data was made available to me and let my model decide what was important and what
        was not using <a href = "https://en.wikipedia.org/wiki/Supervised_learning" class = "inline-link" target = "_blank">
        supervised machine learning</a>. I would feed my model data, and it would tell me what was
        <b>statistically significant</b> in predicting the spread value of an NBA basketball game.</p>
      <h2>Gathering the Data</h2>
      <p>Before starting, all code referenced is made available on my
        <a href = "https://github.com/cac90909/NBA_Project" class = "inline-link" target = "_blank">GitHub</a>.
        Feel free to follow along or check it out!</p>
      <p>The first task ahead of me was gathering the necessary data. I quickly realized that
        <i>www.basketball-reference.com</i> was a <b>goldmine</b> for all information NBA related and would serve
        as a reliable database for my analysis to come.
        The site has all of the players and teams historical data laid out in an easy to read and easy to
        navigate table format.</p>
      <p>For my very first round of analysis, I took a look at the Los Angeles Lakers. I wanted to pay close attention to each
         game played on their schedule and gather all available team stats for all individual games.
         This meant I needed to create a new Beautiful Soup object for <b>every game</b> that the Lakers have played.</p>
      <p>I started the scraping process by gathering a list of links to the box scores of all Lakers games.
         Luckily, basketball reference made this part easy. For each team, they list out the schedule and the box
         score for the corresponding game.</p>
      <img src = "..\..\images\coding\nba_spread\basketball_reference_schedule.JPG"
      alt src = "" class = "content__img">
      <p>I looped through each row of the table and if a data point from a row had an id value of <i>box_score_text</i>, then it
        would be added to my list of links.</p>
        <img src = "..\..\images\coding\nba_spread\list_of_links_function.JPG"
        alt src = "" class = "content__img">
        <img src = "..\..\images\coding\nba_spread\list_of_links_output.JPG"
        alt src = "" class = "content__img">
      <p>Now that I had gathered every link to the Lakers 82 game schedule, the problem became that not every one of those links has a
        box score component. This is because the Lakers are in the midst of their season and haven't played all their games.
         I really only needed the links to the <b>games that have been played</b>.
         I approached this by examining the links.
         Each link has an embedded date after the <i>//boxscores/</i> section in the physical link itself.
         I figured I could turn each substring of the date section of each link into a <b>datetime object</b>
         and then compare that object to a datetime value of <b>yesterday</b>
         (we use yesterday, instead of today, in the case basketball reference doesn’t update the box score
         right after a game has finished, we wouldn't run into any errors).</p>

         <p>At that point, I would have a list of datetime objects for only games that have been played.
         I wanted to compare the length of the datetime object list to the length of the list of links because
         the length of the list of links should be the length of our datetime object list.
         I made this happen by indexing the list of links to the length of the datetime object list.
         This process can be visualized below:</p>
      <img src = "..\..\images\coding\nba_spread\trimming_list_of_links.JPG"
      alt src = "" class = "content__img">
      <p>Additionally, this process allowed me to secure a list of dates for all the games played which
        became useful when I constructed my dataframe later on. </p>
      <p>At that point, I was ready to loop through my list of links to gather the team stats on the Lakers.
        This is illustrated in the following: </p>
      <img src = "..\..\images\coding\nba_spread\looping_through_list_of_links.JPG"
      alt src = "" class = "content__img">
      <p>Then I could combine the stats and the dates gathered into a <b>single dataframe</b>.</p>
      <img src = "..\..\images\coding\nba_spread\dataframe_call.JPG"
      alt src = "" class = "content__img">
      <img src = "..\..\images\coding\nba_spread\dataframe.JPG"
      alt src = "" class = "content__img">
      <h2>Analyzing the Data</h2>
      <p>Having the sufficient data gathered, I wanted to analyze the data to see if I could uncover any meaningful trends.
        Starting out, I wanted to see what my data looked like, so I plotted a distribution of all the y-values of <b>Points For</b>.
        I plotted Points For instead of spread because our dataset did not include how many points the opposing team scored,
        but because Points For is a component of spread, this is not an issue.</p>
        <img src = "..\..\images\coding\nba_spread\points_for_dist.JPG"
        alt src = "" class = "content__img">
      <p>The Lakers’ point distribution is <b>higher</b> than the League’s average of
        <a href = "https://www.basketball-reference.com/leagues/NBA_stats_per_game.html" class = "inline-link" target = "_blank"> 111 </a>
        points per game, which makes sense considering
        that the Lakers are currently <b>47-9</b> and <b>first place</b> in their conference.</p>
      <p>Before moving on to the regression step, I constructed a <b>correlation matrix</b> to see how my variables related
        to one another. </p>
        <img src = "..\..\images\coding\nba_spread\corr_matrix.JPG"
        alt src = "" class = "content__img">
      <p> There were a lot of <b>strong correlations</b> (r > .7) from this matrix. For example, FG and FG% have a .85 correlation value,
        which, again, makes sense considering the two values are intrinsically very related.
        I got rid of the redundant features from the model that measure similar basketball metrics. </p>
      <img src = "..\..\images\coding\nba_spread\statsmodel.api.JPG"
      alt src = "" class = "content__img">
      <img src = "..\..\images\coding\nba_spread\model1_result.JPG"
      alt src = "" class = "content__img">
      <p>This model produced a good <b>adjusted R-squared value</b>, but the model includes a decent number of variables
        that do not have statistical significance, so I removed them from the model.
        In doing so, the following regression resulted: </p>
      <img src = "..\..\images\coding\nba_spread\model2_result.JPG"
      alt src = "" class = "content__img">
      <p>Corresponding to the sequential x-value, the model included the following features:<ul>
        <li>Field Goals Attempted</li>
        <li>Field Goal Percentage</li>
        <li>3 Points Attempted</li>
        <li>3 Point Percentage</li>
        <li>Free Throw Percentage</li>
        <li>Steals</li>
        <li>Personal Fouls</li></ul> </p>
      <p>Next, I used <b>scikit-learn</b> to make some predictions and <b>matplotlib</b> to visualize them. </p>
      <img src = "..\..\images\coding\nba_spread\model_prediction_code.JPG"
      alt src = "" class = "content__img">
      <img src = "..\..\images\coding\nba_spread\model_bar_graph.JPG"
      alt src = "" class = "content__img">
      <p>And finally, I evaluated this model based on its measures of error. I specifically considred
        the model’s <b>Mean Absolute Error</b>, <b>Mean Squared Error</b>, and <b>Square Root of Mean Squared Error</b>. </p>
      <img src = "..\..\images\coding\nba_spread\model_error_terms.JPG"
      alt src = "" class = "content__img">
      <p>Based off of this output, the model seemed to perform decently well at predicting outcome.
        All of the regression coefficients were significant, the x-variables were independent,
      the model had a relatively good adjusted R-squared value, and the predictions produced
       a mean absolute error term of around <b>3.5</b>.
       This error term is favorable considering that NBA teams score well over <b>100 points per game</b>, on average,
       so having a prediction off just a couple points isn't the worst thing in the world. </p>
      <h2>Conceptualizing the Model</h2>
      <p>Moving forward, I had 2 options. I could use induction to conclude that the model’s insight
        into the important <b>core stats</b> (i.e. the x-variables chosen in the final version of the regression model)
        can be applied to any team’s regression model to predict their Points Scored,
        or I could run a regression test on each team to identify their individual set of core stats. </p>
      <p>I applied some basketball reasoning to say that the group of statistics identified as x-variables in my model
        could be indicative of any team’s Points For variable.
        This is logically sound because these core stats seem to be <b>fundamental</b> to any team's performance because they are very rudamentary.
        Additionally, I was still planning on running regression on each team to evaluate the
        core stats individual coefficients for that team, so it wasn't like I was planning on making a
        <b>one-size-fits-all-model</b>.
        If teams have different reliance on specific core stats, then the team's regression coefficients and intercept terms
        should reflect these differences. </p>
      <p>Moving forward, I felt confident that the model would be able to predict the outcome of a game
        if it was given a team’s set of core stats.
        However, the <b>issue is exactly that</b>.
        I needed to be given a team's core stats to predict how many points that team is going to score.
        I needed to come up with a way to predict these core stats for any given matchup.</p>
      <p>I could use a team’s average core stats for that season and substitute those values
        into the regression equation to make the Points For prediction
        (for example, if a team averages 92 field goals attempted a game,
        I would multiply this 92 by the weighted coefficient to get the value of the FGA term of that regression prediction,
        and repeat this process for the remaining features),
        however this neglects the fact that teams core stats are going to differ based on the tier of their opponents defense.
        This is perpetuated by the fact that all core stats deemed significant are all <b>offensive indicators</b>,
        so I needed to implement some sort of <b>defensive consideration</b> into the model.</p>
      <p>Therefore, in order to predict the core stats of a team,
        my plan was to average a team's average core stats with their opponent's respective opponents average core stats.
        My rationale being that a team with a <b>better defense</b> is going to <b>force their opponent</b> to <b>average lower core stats</b>.
        I realize that this sounds very wordy, but I’m going to draw it out.
        Let’s take, for example, the Lakers and Bucks matchup that is happening tonight: </p>
      <img src = "..\..\images\coding\nba_spread\prediction_flowchart.jpg"
      alt src = "" class = "content__img">
      <p>I always <b>balance out</b> teams average core stats with the team that they are playing opponents’ core stats,
        because this serves to be a weight for that team’s defensive performance.
        A team that plays good defense is going to keep their opponent's core stats to smaller amounts. </p>
      <p>Therefore, one of the last steps was to write some code to gather a team’s opponent’s season stats.
        This is pretty similar to the code I wrote before,
        except I had to add more comparison statements because it is not quite as easy to identify a team’s opponents
        in HTML compared to the original team itself.
        Regardless, the code is shown below:</p>
      <img src = "..\..\images\coding\nba_spread\gathering_opp_data.JPG"
      alt src = "" class = "content__img">
      <p>Up to this point, I had written all the individual parts necessary to calculate the predictions.
        I just needed to combine these individual parts and then wrap them into a function
        so that I could automate this process for any given matchup on any given day.</p>
      <p>I’m not going to paste that code here for simplicity sake,
        but the only thing different is that I aggregated all of the above processes into a single function that requires two parameters:
        <b>“team 1 abbreviation”</b> and <b>“team 2 abbreviation”</b>.
        The function will go to basketball reference, create a list of links to box scores of games that have already happened,
        gather the teams data, gather the opponents teams data, and then perform regression on their core stats.
        The function will then do the same set of processes for the opposing team.
        The function takes the average of the cross referenced core stats to use as x-coordinates for the regression model,
        the function then calculates each team’s points scored, and finally the function arrives at the <b>final spread value</b>.
        Again, all of this code can be found on my
        <a href = "https://github.com/cac90909/NBA_Project" class = "inline-link" target = "_blank">GitHub page.</a> </p>
      <p>The input and output of this function is going to look something like this: </p>
      <img src = "..\..\images\coding\nba_spread\gatherAndAnalyze.JPG"
      alt src = "" class = "content__img">
      <p>The last function I wanted to write was one to automate this calling of <i>gatherAndAnalyze()</i>.
        I wanted to be able to just type in the name of the function and have it predict the scores of all the games played today.
        So, that is what I wrote with the function <i>predictGamesToday()</i>.</p>
        <p>  Basketball reference organizes their
          games in a monthly manner, as shown in the image at the beginning of this article when talking about extracting box score links,
          so the standard link for this month's games would look like this: </p>
        <img src = "..\..\images\coding\nba_spread\month_link.JPG"
        alt src = "" class = "content__img">
        <p>In order to assemble this link, I simply made a datetime object for the current time, extracted the month,
          and then translated it into the name of
          the actual month using this <b>dictionary</b>:</p>
          <img src = "..\..\images\coding\nba_spread\months_mapped.JPG"
          alt src = "" class = "content__img">
        <p>Next, I did a comparison to make sure I was only looking at games for the current date, then sliced the strings of those
          table rows for the names of the actual teams.
          With the aid of list comprehension, anonymous functions, and mappings, this process was made fairly easy.
          <img src = "..\..\images\coding\nba_spread\fancy_function_calls.JPG"
          alt src = "" class = "content__img">
        <p>All that was left to do was loop through the list of teams playing today,
          pair off each sequential team as a matchup, and then call
          <i>gatherAndAnalyze()</i> on each matchup. The input and output of this process is illustrated below: </p>
          <img src = "..\..\images\coding\nba_spread\final_automation.JPG"
          alt src = "" class = "content__img">
      <h2>Evaluating the Model</h2>
      <p>Over the next week, I ran this program on all the games played, collecting a sample size of around 60.
        The model did not perform all too well in predicting spread.
        It had a <b>Mean Absolute Error</b> of <b>11.4</b>,
        which is pretty significant considering spreads will typically range from 1 - 20 (in absolute value terms). </p>
      <p>However, my model did perform pretty well when it came to actually predicting the outcome of that same sample.
        It displayed a <b>75% accuracy rating</b> in correctly predicting outcome.</p>
        <img src = "..\..\images\coding\nba_spread\predict_Excel.JPG"
        alt src = "" class = "content__img">
        <p>
        However, this might be due to the fact that a lot of basketball games are
        not too challenging to predict since oftentimes games contain uneven matchups.
        For example, the 78% win percentage Lakers playing against the 36% win percentage Wizards
        is a game whose outcome shouldn't prove to be too difficult to predict.
        On the other hand, predicting the extent to which a team will win, via spread, is <b>much more difficult to do</b>.</p>

      <p>Regardless, I set out to defy the odds and produce a model that could successfully predict the spread of an NBA matchup.
        I certainly learned a lot,
        but I do not believe I learned how to make a model that can reliably predict the spread of a professional basketball game. </p>
      <p>Moving forward, I believe my model was successful in the fact that it considered the data it needed to.
        At its core, the regressions were mainly looking at <b>offensive efficiency</b> since 3 of the 7 features were FG%, FT%, and 3P%.
      </p><p>However, my model could have been improved if it changed how it weighted data.
        Data from the beginning of the season and data from yesterday’s game are given the same weight.
        This could be problematic when more <b>recent data</b> can reveal<b> deeper insight</b> into <b>current trends</b>.
        For example, perhaps a Team acquired a player in a trade that changes their trajectory within the league.
        This player management acquistion won't become apparent in the data right away,
        so it will be a consideration our model neglects to recognize and take account for.
      </p><p>I would like to see this same model implemented, but with a <a href="https://en.wikipedia.org/wiki/Weighted_arithmetic_mean" class = "inline-link" target = "_blank"> moving average </a>
        mechanism instead to properly weight more recent data, while still keeping track of long term trends.</p>
        <p> And finally, the moment WE ALL HAVE BEEN WAITING FOR, the time to <b>put my money where my mouth is</b> (not literally).
          I wanted to have a little bit of <i>risque</i> fun by actually betting on NBA games.
          So, I made an account on the sports betting website "Bovada".
          I'm not going to lie, there is definetly an initial learning curve to fully understanding how the betting process works
          because the layout and numbers are mildly confusing:</p>
            <img src = "..\..\images\coding\nba_spread\bovada_example.JPG"
            alt src = "" class = "content__img">
        <p>But after about 45 minutes of YouTube tutorial on "how to place sports bets", I finally gained a stronger understanding.
          When it came time to actually placing some bets, I honestly did pretty well.
          Since my model performed best in predicting outcome, I chose to do MoneyLine betting, predicting which team is going to win,
          rather than trying to predict spread and inevitably losing <b>all $30 of my startup funds</b>.
          MoneyLine compensates uneven matchups by granting less return on matchups that are more predictable. For example,
          betting the Lakers will beat the Wizards would hypothetically grant much less return than betting the vice versa</p>
        <p>My strategy was to <b>solely let my model make my bets for me</b>.
          If the regression told me a team was going to win, even when they appeared not to be a winning position, then I would
          put money down on that team. Despite a constant paranoia that my model was trying to seek revenge on my bank account,
          I actually ended up with a solid <b>return on investment</b>. I initially put in $30, which was accompanied by a $15 bonus
          fund paid for by Bovada as a part of one of their promotions, and ended up with a little over <b>$70</b> in my Bovada account.
          <img src = "..\..\images\coding\nba_spread\cumulative_earnings.JPG"
          alt src = "" class = "content__img">
          I honestly believe that the money made was more luck than skill, so I think I'm going to give a red light to
          my betting career and instead spend my enormous net earnings on a nice meal in the city.</p>
      <p>Regardless of all outcomes, this was an awesome, yet at times frustrating, project to work on!
        I hope to do many more projects that are similar to this. Thank you for reading! </p>



    </div>

    <!-- Footer -->
    <footer class="footer">
      <a href ="mailto:chris.castro@emory.edu" class = "footer__link">chris.castro@emory.edu</a>
      <ul class = "social-list">
        <li class = "social-list__item">
          <a class = "social-list__link" href = "https://github.com/cac90909" target = "_blank">
            <i class="fab fa-github"></i>
          </a>
        </li>
        <li class = "social-list__item">
          <a class = "social-list__link" href = "https://www.instagram.com/thecyclecooking/" target = "_blank">
            <i class="fab fa-instagram"></i>
          </a>
        </li>
        <li class = "social-list__item">
          <a class = "social-list__link" href = "https://www.linkedin.com/in/christophercastro555/" target = "_blank">
            <i class="fab fa-linkedin"></i>
          </a>
        </li>
        <li class = "social-list__item">
          <a class = "social-list__link" href = "https://www.goodreads.com/user/show/111006989-chris" target = "_blank">
            <i class="fab fa-goodreads"></i>
          </a>
        </li>
      </ul>
    </footer>


    <script src="..\..\js\index.js"></script>

    </body>
  </html>
